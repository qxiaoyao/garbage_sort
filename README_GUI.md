# 垃圾分类检测系统 - Web GUI

## 功能特性

1. **图片检测**: 在网页中上传图片，系统会自动检测并返回标注后的结果图片
2. **实时摄像头检测**: 支持打开摄像头进行实时垃圾分类检测
3. **多摄像头支持**: 
   - 支持选择电脑内置摄像头 (索引 0)
   - 支持外接USB摄像头 (索引 1)
   - 支持通过WiFi连接的手机摄像头 (自定义IP地址)

## 安装依赖

```bash
pip install -r requirements.txt
```

需要安装的包：
- `fastapi` - Web框架
- `uvicorn` - ASGI服务器
- `python-multipart` - 用于处理文件上传
- `opencv-python` - 图像处理和摄像头捕获
- `jinja2` - HTML模板引擎

## 使用方法

### 1. 启动服务

在项目根目录运行：

```bash
python app.py
```

或者使用uvicorn命令：

```bash
uvicorn app:app --host 0.0.0.0 --port 8000 --reload
```

服务启动后，在浏览器访问：`http://localhost:8000`

### 2. 图片检测

1. 点击"选择图片"按钮，选择要检测的图片
2. 点击"开始检测"按钮
3. 等待检测完成，查看标注后的结果图片和分类信息

### 3. 实时摄像头检测

#### 使用电脑摄像头：
1. 在下拉菜单中选择"电脑摄像头 (0)"或"外接摄像头 (1)"
2. 点击"启动摄像头"按钮
3. 系统会实时显示检测结果
4. 点击"停止摄像头"按钮可停止检测

#### 使用手机摄像头（通过WiFi）：

**安卓手机：**
1. 在手机上安装 **IP Webcam** 应用
2. 打开应用，点击"启动服务器"
3. 应用会显示一个IP地址，例如：`http://192.168.1.100:8080`
4. 在浏览器视频流地址后添加 `/video`，例如：`http://192.168.1.100:8080/video`

**iOS手机：**
1. 在手机上安装 **EpocCam** 或 **iVCam** 应用
2. 确保手机和电脑在同一WiFi网络
3. 按照应用说明获取视频流地址

**在Web界面中使用：**
1. 在下拉菜单中选择"自定义地址"
2. 在输入框中输入手机摄像头的视频流地址
3. 点击"启动摄像头"开始检测

## 项目结构

```
garbage_sorting/
├── app.py                      # FastAPI主程序
├── garbage/
│   ├── cv.py                   # 原始摄像头检测代码
│   └── infer_and_map.py        # 推理和映射函数
|   |__ train.py               # 训练代码
|   |__ garbage_train/         # 权重文件，模型性能可视化
├── templates/
│   └── index.html              # Web界面HTML模板
├── uploads/                    # 上传图片存储目录（自动创建）
├── results/                    # 检测结果存储目录（自动创建）
├── requirements.txt            # Python依赖包
└── README_GUI.md              # 本说明文档
```

## API接口

### 1. 主页
- **URL**: `/`
- **方法**: GET
- **说明**: 返回Web界面HTML页面

### 2. 上传图片检测
- **URL**: `/upload`
- **方法**: POST
- **参数**: `file` - 图片文件
- **返回**: JSON格式的检测结果

### 3. 启动摄像头
- **URL**: `/camera/start/{source}`
- **方法**: GET
- **参数**: `source` - 摄像头索引或IP地址
- **返回**: JSON格式的状态信息

### 4. 停止摄像头
- **URL**: `/camera/stop`
- **方法**: GET
- **返回**: JSON格式的状态信息

### 5. 视频流
- **URL**: `/camera/stream`
- **方法**: GET
- **返回**: MJPEG视频流

### 6. 摄像头状态
- **URL**: `/camera/status`
- **方法**: GET
- **返回**: JSON格式的当前状态

## 注意事项

1. **网络要求**: 使用手机摄像头时，确保手机和电脑在同一局域网
2. **性能**: 实时检测需要较高的计算资源，建议使用GPU加速
3. **端口**: 默认使用8000端口，如需修改请在`app.py`中更改
4. **安全性**: 本系统仅供局域网使用，请勿直接暴露到公网

## 常见问题

**Q: 摄像头无法启动？**
A: 检查摄像头是否被其他程序占用，或尝试更换摄像头索引

**Q: 手机摄像头连接失败？**
A: 确保手机和电脑在同一WiFi网络，并检查IP地址和端口是否正确

**Q: 检测速度慢？**
A: 可以在`infer_and_map_big_category`函数中调整`conf_thres`置信度阈值，或使用更小的模型

**Q: 上传图片失败？**
A: 检查图片格式是否支持（建议使用jpg、png格式），文件大小是否过大

